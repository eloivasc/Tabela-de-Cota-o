<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planilha de Cotação de Preços</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define a fonte Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Cor de fundo suave */
        }
        /* Estilo para o preço mínimo */
        .min-price {
            background-color: #fee2e2; /* Cor de fundo vermelho claro */
            color: #dc2626; /* Cor do texto vermelho escuro */
            font-weight: bold;
        }
        /* Estilo para a célula de preço editável */
        .editable-price {
            min-width: 80px; /* Largura mínima para as células de preço */
        }
        /* Estilo para o input de preço */
        .price-input {
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #d1d5db; /* border-gray-300 */
            text-align: right;
        }
        /* Estilo para o input de nome da empresa */
        .company-name-input {
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 lg:p-10">
    <div class="max-w-6xl mx-auto bg-white p-6 rounded-lg shadow-xl">
        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">Planilha de Cotação de Preços - MORORÓ FARMA</h1>

        <!-- Formulário para adicionar novos itens -->
        <div class="mb-8 p-6 bg-gray-50 rounded-lg shadow-inner">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Adicionar Novo Item</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div class="col-span-1 md:col-span-1">
                    <label for="itemName" class="block text-sm font-medium text-gray-700 mb-1">Nome do Item:</label>
                    <input type="text" id="itemName" placeholder="Ex: Caneta Esferográfica" class="w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                <!-- Inputs para os preços das 6 empresas -->
                <div class="col-span-1 md:col-span-2 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-4">
                    <div class="col-span-1">
                        <label for="company1" class="block text-sm font-medium text-gray-700 mb-1">
                            <input type="text" id="companyNameInput1" value="Empresa 1" class="company-name-input text-center">
                        </label>
                        <input type="number" id="company1" value="0" min="0" step="0.01" class="price-input">
                    </div>
                    <div class="col-span-1">
                        <label for="company2" class="block text-sm font-medium text-gray-700 mb-1">
                            <input type="text" id="companyNameInput2" value="Empresa 2" class="company-name-input text-center">
                        </label>
                        <input type="number" id="company2" value="0" min="0" step="0.01" class="price-input">
                    </div>
                    <div class="col-span-1">
                        <label for="company3" class="block text-sm font-medium text-gray-700 mb-1">
                            <input type="text" id="companyNameInput3" value="Empresa 3" class="company-name-input text-center">
                        </label>
                        <input type="number" id="company3" value="0" min="0" step="0.01" class="price-input">
                    </div>
                    <div class="col-span-1">
                        <label for="company4" class="block text-sm font-medium text-gray-700 mb-1">
                            <input type="text" id="companyNameInput4" value="Empresa 4" class="company-name-input text-center">
                        </label>
                        <input type="number" id="company4" value="0" min="0" step="0.01" class="price-input">
                    </div>
                    <div class="col-span-1">
                        <label for="company5" class="block text-sm font-medium text-gray-700 mb-1">
                            <input type="text" id="companyNameInput5" value="Empresa 5" class="company-name-input text-center">
                        </label>
                        <input type="number" id="company5" value="0" min="0" step="0.01" class="price-input">
                    </div>
                    <div class="col-span-1">
                        <label for="company6" class="block text-sm font-medium text-gray-700 mb-1">
                            <input type="text" id="companyNameInput6" value="Empresa 6" class="company-name-input text-center">
                        </label>
                        <input type="number" id="company6" value="0" min="0" step="0.01" class="price-input">
                    </div>
                </div>
            </div>
            <button id="addItemBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-150 ease-in-out shadow-md">
                Adicionar Item
            </button>
        </div>

        <!-- Tabela de cotação de preços -->
        <div class="overflow-x-auto rounded-lg shadow-md border border-gray-200">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-100">
                    <tr id="tableHeaderRow">
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item</th>
                        <!-- Cabeçalhos das empresas serão gerados por JavaScript -->
                        <th scope="col" class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                    </tr>
                </thead>
                <tbody id="priceTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Linhas de itens serão adicionadas aqui por JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const NUM_COMPANIES = 6; // Define o número de empresas

        // Array para armazenar os nomes das empresas
        let companyNames = [];

        // Função para formatar números como moeda brasileira
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Função para destacar o menor preço em uma linha
        function highlightMinPrice(row) {
            const priceCells = row.querySelectorAll('.editable-price');
            let minPrice = Infinity;
            let minPriceCells = [];

            // Encontra o menor preço e as células correspondentes
            priceCells.forEach(cell => {
                // Remove qualquer destaque anterior
                cell.classList.remove('min-price');
                const price = parseFloat(cell.textContent.replace('R$', '').replace('.', '').replace(',', '.'));
                if (!isNaN(price) && price < minPrice) {
                    minPrice = price;
                    minPriceCells = [cell]; // Reinicia a lista se um novo mínimo for encontrado
                } else if (!isNaN(price) && price === minPrice) {
                    minPriceCells.push(cell); // Adiciona à lista se for igual ao mínimo atual
                }
            });

            // Aplica o destaque a todas as células com o menor preço
            minPriceCells.forEach(cell => {
                cell.classList.add('min-price');
            });
        }

        // Função para atualizar os cabeçalhos da tabela com os nomes das empresas
        function updateTableHeader() {
            const tableHeaderRow = document.getElementById('tableHeaderRow');
            // Remove os cabeçalhos de empresa existentes (exceto o de Item e Ações)
            Array.from(tableHeaderRow.children).slice(1, -1).forEach(th => th.remove());

            // Adiciona os novos cabeçalhos de empresa
            companyNames.forEach(name => {
                const th = document.createElement('th');
                th.scope = 'col';
                th.classList.add('px-4', 'py-3', 'text-center', 'text-xs', 'font-medium', 'text-gray-500', 'uppercase', 'tracking-wider');
                th.textContent = name;
                // Insere antes da última coluna (Ações)
                tableHeaderRow.insertBefore(th, tableHeaderRow.lastElementChild);
            });
        }

        // Função para adicionar um novo item à tabela
        function addItem() {
            const itemName = document.getElementById('itemName').value.trim();
            const companyPrices = [];
            for (let i = 1; i <= NUM_COMPANIES; i++) {
                let price = parseFloat(document.getElementById(`company${i}`).value);
                // Se o preço for NaN (não é um número), define como 0
                if (isNaN(price)) {
                    price = 0;
                }
                companyPrices.push(price);
            }

            if (itemName === '') {
                // Usar uma modal customizada em vez de alert()
                // Para simplificar, vou usar um alert simples aqui, mas em um app real seria uma modal.
                alert("Por favor, insira o nome do item.");
                return;
            }

            const tableBody = document.getElementById('priceTableBody');
            const newRow = document.createElement('tr');
            newRow.classList.add('hover:bg-gray-50');

            // Célula para o nome do item
            const itemCell = document.createElement('td');
            itemCell.textContent = itemName;
            itemCell.classList.add('px-4', 'py-3', 'text-sm', 'font-medium', 'text-gray-900', 'whitespace-nowrap');
            newRow.appendChild(itemCell);

            // Células para os preços das empresas
            companyPrices.forEach(price => {
                const priceCell = document.createElement('td');
                priceCell.textContent = formatCurrency(price);
                priceCell.classList.add('px-4', 'py-3', 'text-sm', 'text-gray-700', 'text-right', 'editable-price', 'whitespace-nowrap');
                // Torna a célula editável
                priceCell.contentEditable = true;
                // Adiciona um listener para atualizar o destaque quando o preço for editado
                priceCell.addEventListener('input', () => {
                    // Remove o formato de moeda para obter o valor numérico para o cálculo
                    const rawValue = priceCell.textContent.replace('R$', '').replace('.', '').replace(',', '.');
                    const updatedPrice = parseFloat(rawValue);
                    if (!isNaN(updatedPrice)) {
                        // Atualiza o texto da célula com o valor formatado novamente
                        priceCell.textContent = formatCurrency(updatedPrice);
                        highlightMinPrice(newRow);
                    } else {
                        // Se o valor digitado não for um número válido, reverte para o último valor válido ou 0
                        priceCell.textContent = formatCurrency(0); // Ou o último valor válido
                        highlightMinPrice(newRow);
                    }
                });
                // Adiciona um listener para garantir que apenas números sejam digitados
                priceCell.addEventListener('keydown', (e) => {
                    // Permite números, vírgula, ponto, backspace, delete, setas
                    if (!((e.key >= '0' && e.key <= '9') ||
                          e.key === ',' || e.key === '.' ||
                          e.key === 'Backspace' || e.key === 'Delete' ||
                          e.key === 'ArrowLeft' || e.key === 'ArrowRight' || e.key === 'Tab')) {
                        e.preventDefault();
                    }
                });
                newRow.appendChild(priceCell);
            });

            // Célula para o botão de excluir
            const actionCell = document.createElement('td');
            actionCell.classList.add('px-4', 'py-3', 'text-sm', 'text-gray-700', 'text-center', 'whitespace-nowrap');
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Excluir';
            deleteButton.classList.add('bg-red-500', 'text-white', 'py-1', 'px-3', 'rounded-md', 'hover:bg-red-600', 'focus:outline-none', 'focus:ring-2', 'focus:ring-red-500', 'focus:ring-offset-2', 'transition', 'duration-150', 'ease-in-out', 'shadow-sm');
            deleteButton.addEventListener('click', () => {
                newRow.remove(); // Remove a linha da tabela
            });
            actionCell.appendChild(deleteButton);
            newRow.appendChild(actionCell);


            tableBody.appendChild(newRow);

            // Destaca o menor preço na nova linha
            highlightMinPrice(newRow);

            // Limpa os campos do formulário
            document.getElementById('itemName').value = '';
            for (let i = 1; i <= NUM_COMPANIES; i++) {
                document.getElementById(`company${i}`).value = '0';
            }
        }

        // Adiciona o listener ao botão de adicionar item
        document.getElementById('addItemBtn').addEventListener('click', addItem);

        // Inicializa os nomes das empresas e os listeners de input
        window.onload = function() {
            for (let i = 1; i <= NUM_COMPANIES; i++) {
                const inputId = `companyNameInput${i}`;
                const inputElement = document.getElementById(inputId);
                if (inputElement) {
                    companyNames.push(inputElement.value); // Adiciona o valor inicial ao array
                    inputElement.addEventListener('input', (event) => {
                        companyNames[i - 1] = event.target.value; // Atualiza o array
                        updateTableHeader(); // Re-renderiza o cabeçalho
                    });
                }
            }
            updateTableHeader(); // Renderiza o cabeçalho inicial

            // Adiciona um exemplo de item ao carregar a página
            document.getElementById('itemName').value = 'Caderno Universitário';
            document.getElementById('company1').value = '25.50';
            document.getElementById('company2').value = '22.90';
            document.getElementById('company3').value = '28.00';
            document.getElementById('company4').value = '21.00';
            document.getElementById('company5').value = '23.50';
            document.getElementById('company6').value = '20.50';
            addItem();

            document.getElementById('itemName').value = 'Mochila Escolar';
            document.getElementById('company1').value = '150.00';
            document.getElementById('company2').value = '145.00';
            document.getElementById('company3').value = '160.00';
            document.getElementById('company4').value = '130.00';
            document.getElementById('company5').value = '155.00';
            document.getElementById('company6').value = '125.00';
            addItem();

            // Limpa os campos após adicionar os exemplos
            document.getElementById('itemName').value = '';
            for (let i = 1; i <= NUM_COMPANIES; i++) {
                document.getElementById(`company${i}`).value = '0';
            }
        };
    </script>
</body>
</html>
